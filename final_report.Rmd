---
title: "Final Report for MA678 Project"
author: "Daniel(Chen) Xu BUID:U49903384"
date: "12/10/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = F,message = F,echo=F,highlight=F)
knitr::opts_chunk$set(fig.width=7, fig.height=5,fig.align = "center") 
pacman::p_load("tidyverse","tidyr","knitr","dplyr","viridis","hrbrthemes","mosaic","readr","lubridate","tibble","lme4","rstanarm","gridExtra")
```

```{r}
df_rs_aver_final <- read.csv("df_final.csv")
```

## Abstract:

The National Basketball Association (NBA) is a professional basketball league in North America. The league is composed of 30 teams (29 in the United States and 1 in Canada) and is one of the four major professional sports leagues in the United States and Canada. It is the premier men's professional basketball league in the world. The league was founded in New York City on June 6, 1946, as the Basketball Association of America (BAA). It changed its name to the National Basketball Association on August 3, 1949, after merging with the competing National Basketball League (NBL). The NBA's regular season runs from October to April, with each team playing 82 games. As the premier professional basketball league in the world, the change in style of basketball in the NBA led to the change in style of modern basketball. Here rises problems: Which statistical data of basketball best captures the changing style of modern basketball and how these types of data determine the injury situation for players of each season in today's style of basketball? To address those problems. I use Exploratory Data Analysis to find the factors related to the change of play style and use some statistics to build a multilevel model. However, the model shows that the variables all have a slight impact on the injury situation for each player and is slightly different between seasons as the style of basketball changes as time passes. This report consisted of 5 main parts: Introduction, Method, Result and Discussion. 

## Introduction:

The game of basketball has worldwide appeal. It requires speed, athleticism, skill and the ability to stay calm in the most hectic moments of the game. Basketball has undergone many changes since James Naismith invented the game to give his students something to do when the cold weather prevented them from playing sports outside. As the representative basketball league in the world, in order to gradually improve the ornamental and competitive basketball. The NBA has gone through several landmark rule changes. These rule changes have directly or indirectly affected the development and style of basketball. For example, the establishment of the 3-point line, the establishment of the defensive 3-second violation, the expansion of the 3-second zone, etc. From my point of view, two changes contributed to the style of basketball now, the first one is setting the hand check as a blocking foul outside the 3-point line and the second is the establishment of the 3-point line. The hand check is a defensive maneuver that is made on the ball-handler. When a defender would extend an arm and use his hand to initiate contact with the ball-handler. Without defenders using their hands to initiate contact outside the 3-point line, players nowadays have more space to take a relatively more efficient offensive choice: shoot 3-point. I will present how the average number of 3 point attempts per game change from the Season 2010 - 2011 to the Season 2019 - 2020.

Therefore I use a multilevel model to see what and how factors may influence the injury level of a player in a season. Before that, I clean the data and combine some information collected from YouTube for the same talk video.

## Method

### Data Cleaning and Processing:


| Column Names | Explanation |
| :--: | :----- |
| Season        | NBA regular season year range |
| Age           | Player's Age |
| PER           | Player Efficiency Rating |
| GP            | The number of games a player play in a season |
| MPG           | Average minutes a player play per game |
| PFPG          | Average number of personal fouls per game |
| X3PAPG        | Average number of 3 points attempt per game |
| height_cm     | Player's height in centimeter |
| weight_kg     | Player's weight in kilogram |
| injury_level  | A level summarizes the injury situation for each player of each season |



### Exploratory Data Analysis:

```{r}
ggplot(df_rs_aver_final, aes(x = Season, y = X3PAPG, fill = Season)) +
    geom_violin(size=0.5)+
    geom_boxplot(width=0.5, alpha=0.5)+
    scale_fill_viridis(discrete = TRUE, alpha=0.2, option = "D")+
  theme_bw()+
  theme(legend.position="none",plot.title = element_text(size=15))+ggtitle("Number of 3 Points attempt per game distribution from season 2010-2011 to season 2019-2020")
```

```{r}
# MPG vs. injury_level:
mpg_il <- ggplot(df_rs_aver_final, aes(x = MPG , y = injury_level, color = Season))+
  geom_point(alpha = 0.3)+
  geom_smooth(method = "loess", formula = "y~x",se = F)+
  scale_fill_viridis(discrete = TRUE, alpha=0.2, option = "D")+
  theme_bw()+
  ggtitle("Minutes play per game vs. Injury Level")+
  xlab("Minutes play per game")+
  ylab("Injury Level")+
  theme(legend.key.size = unit(1, 'cm'), legend.text = element_text(size=12),axis.text=element_text(size=12),
        axis.title=element_text(size=12), axis.text.x = element_text(angle = 45, hjust=1), legend.position = "none")

# GP vs. injury_level:
gp_il <- ggplot(df_rs_aver_final, aes(x = GP , y = injury_level, color = Season))+
  geom_point(alpha = 0.3)+
  geom_smooth(method = "loess", formula = "y~x",se = F)+
  scale_fill_viridis(discrete = TRUE, alpha=0.2, option = "D")+
  theme_bw()+
  ggtitle("Number of Games played in a Season vs. Injury Level")+
  xlab("Number of Games in a Season")+
  ylab("Injury Level")+
  theme(legend.key.size = unit(1, 'cm'), legend.text = element_text(size=12),axis.text=element_text(size=12),
        axis.title=element_text(size=12), axis.text.x = element_text(angle = 45, hjust=1))

# X3PAPG vs. injury_level:
x3papg_il <- ggplot(df_rs_aver_final, aes(x = X3PAPG , y = injury_level, color = Season))+
  geom_point(alpha = 0.3)+
  geom_smooth(method = "loess", formula = "y~x",se = F)+
  scale_fill_viridis(discrete = TRUE, alpha=0.2, option = "D")+
  theme_bw()+
  ggtitle("Number of 3 points attempts per game vs. Injury Level")+
  xlab("Number of 3 points attempts per gam")+
  ylab("Injury Level")+
  theme(legend.key.size = unit(1, 'cm'), legend.text = element_text(size=12),axis.text=element_text(size=12),
        axis.title=element_text(size=12), axis.text.x = element_text(angle = 45, hjust=1),legend.position = "none")

# PFPG vs. injury_level:

pfpg_il <- ggplot(df_rs_aver_final, aes(x = PFPG , y = injury_level, color = Season))+
  geom_point(alpha = 0.3)+
  geom_smooth(method = "loess", formula = "y~x",se = F)+
  scale_fill_viridis(discrete = TRUE, alpha=0.2, option = "D")+
  theme_bw()+
  ggtitle("Number of personal fouls per game vs. Injury Level")+
  xlab("Number of personal fouls per game")+
  ylab("Injury Level")+
  theme(legend.key.size = unit(1, 'cm'), legend.text = element_text(size=12),axis.text=element_text(size=12), axis.title=element_text(size=12), axis.text.x = element_text(angle = 45, hjust=1))
```


```{r}
grid.arrange(mpg_il,gp_il, nrow=1)
```

```{r}
grid.arrange(x3papg_il,pfpg_il, nrow = 1)
```



### Model Fitting:


## Result:

# Model build:

We can conclude that the formula:

$$
Injury Level = 9.93 + 0.014 {\times} height_{cm} + 0.013 {\times} weight_{kg} - 0.0016 {\times} Age + 0.14 {\times} MPG + 0.041 {\times} X3PAPG - 0.16 {\times} GP +  0.38 {\times} PFPG + 0.024 {\times} PER
$$

Indicator select:
Season, MPG, GP, PFPG, X3PAPG, height_cm, weight_kg, Age, PER, PFPG

```{r}
# Standardize the outcome:
fit1 <- lmer(injury_level ~ height_cm + weight_kg + Age + MPG + X3PAPG + GP + PFPG + PER + (1|Season), df_rs_aver_final) 
#summary(fit1)
#coefficients(fit1)
```



### Model Validation:

```{r echo=FALSE, fig.cap="Residual plot and Q-Q plot."}
re <- plot(fit1)
qq <- qqmath(fit1)
grid.arrange(re,qq,nrow=1)
```



```{r echo=FALSE, fig.cap="Residuals vs Leverage."}
ggplot(data.frame(lev=hatvalues(fit1),pearson=residuals(fit1,type="pearson")),
      aes(x=lev,y=pearson)) +
    geom_point() +
    theme_bw()
```

## Discussion:



## Citation:

https://www.sportsrec.com/358083-the-history-of-basketball-for-kids.html
https://dunkorthree.com/hand-checking-rule-nba/
https://www.kaggle.com/justinas/nba-players-data
https://www.kaggle.com/ghopkins/nba-injuries-2010-2018



\newpage
## Appendix
### More EDA

